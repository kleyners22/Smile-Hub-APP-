<ui:composition template="/WEB-INF/template/base.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:p="primefaces">

    <f:metadata>
        <f:viewAction action="#{userSession.checkLogin()}" />
    </f:metadata>

    <ui:define name="title-view">SMILEHUB - Dashboard Secretaría</ui:define>

    <ui:define name="content">
        <h:form id="dashForm">
            <p:growl id="msgs" showDetail="true" />

            <div class="dashboard-body">
                <!-- Header con botones PrimeFaces -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2 style="margin: 0; color: #1e293b;">Bienvenida, #{userSession.user.name}</h2>
                        <p style="margin: 0; color: #64748b;">Panel de gestión de citas SmileHub</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <p:commandButton value="Nueva Cita" icon="pi pi-plus" styleClass="ui-button-primary" />
                        <p:commandButton value="Cerrar Sesión" icon="pi pi-sign-out"
                                         action="#{authenticationController.logout}"
                                         styleClass="ui-button-danger ui-button-flat"
                                         process="@this" />
                    </div>
                </div>

                <!-- KPIs -->
                <div class="kpi-container">
                    <div class="kpi-card bg-blue">
                        <span class="kpi-value">#{dashboardController.citasHoy}</span>
                        <span class="kpi-label">Citas Hoy</span>
                    </div>
                    <div class="kpi-card bg-yellow">
                        <span class="kpi-value">#{dashboardController.pendientes}</span>
                        <span class="kpi-label">Pendientes</span>
                    </div>
                    <div class="kpi-card bg-green">
                        <span class="kpi-value">#{dashboardController.realizadas}</span>
                        <span class="kpi-label">Realizadas</span>
                    </div>
                    <div class="kpi-card bg-purple">
                        <span class="kpi-value">#{dashboardController.nuevosPacientes}</span>
                        <span class="kpi-label">Nuevos Pacientes</span>
                    </div>
                </div>

                <!-- Panel principal -->
                <div class="main-grid">
                    <div class="panel-white">
                        <h3 style="margin-top: 0; color: #334155;">Calendario de Citas</h3>
                        <p:calendar id="inline" mode="inline" style="width: 100%"/>
                    </div>

                    <div class="panel-white">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #334155;">Próximas Citas (Hoy)</h3>
                            <p:commandLink value="Ver todas" style="color: #2563eb; font-weight: 600;"/>
                        </div>

                        <ui:repeat value="#{dashboardController.proximasCitas}" var="cita">
                            <div class="cita-item" style="border-left-color: #{cita.color}; background: #{cita.bgColor};">
                                <div>
                                    <span style="font-weight: 700; color: #{cita.textColor}; font-size: 1.1rem;">
                                        #{cita.hora} - #{cita.tipo}
                                    </span><br/>
                                    <span style="color: #1e293b;">#{cita.pacienteNombre}</span>
                                </div>
                                <div style="text-align: right;">
                                    <p:commandButton icon="pi pi-pencil"
                                                     styleClass="ui-button-rounded ui-button-#{cita.buttonColor} ui-button-flat" />
                                </div>
                            </div>
                        </ui:repeat>
                    </div>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>